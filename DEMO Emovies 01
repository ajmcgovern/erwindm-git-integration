
CREATE TABLE CUST
(
	CUST_ADDRESS VARCHAR(20) NULL ,
	CUST_CITY VARCHAR(20) NULL ,
	CUST_FIRST_NAME VARCHAR(20) NULL ,
	CUST_LAST_NAME VARCHAR(20) NULL ,
	CUST_STATE VARCHAR(20) NULL ,
	CUST_ZIP_CODE NUMBER(38,0) NULL ,
	EMAIL VARCHAR(16777216) NULL ,
	CUST_NUMBER NUMBER(38,0) NOT NULL 
)
DATA_RETENTION_TIME_IN_DAYS = 1;

CREATE TABLE CUST_CREDIT
(
	CREDIT_CARD NUMBER(38,0) NULL ,
	CREDIT_CARD_EXP NUMBER(38,0) NULL ,
	STATUS_CODE VARCHAR(20) NULL ,
	CUST_NUMBER NUMBER(38,0) NOT NULL 
)
DATA_RETENTION_TIME_IN_DAYS = 1;

CREATE TABLE EMP
(
	EMP_FIRST_NAME VARCHAR(20) NULL ,
	EMP_ADDRESS VARCHAR(20) NULL ,
	EMP_PHONE NUMBER(38,0) NULL ,
	STORE_NUMBER NUMBER(38,0) NULL ,
	EMP_ADDRESS_2 VARCHAR(20) NULL ,
	EMAIL VARCHAR(20) NULL ,
	SALARY NUMBER(38,0) NULL ,
	HIRE_DATE DATE NULL ,
	SOC_SEC_NUMBER NUMBER(38,0) NULL ,
	EMP_NUMBER VARCHAR(20) NOT NULL ,
	SUPERVISOR VARCHAR(20) NOT NULL 
)
DATA_RETENTION_TIME_IN_DAYS = 1;

CREATE TABLE MOVIE_COPY
(
	GENERAL_CONDITION VARCHAR(20) NULL ,
	MOVIE_FORMAT VARCHAR(20) NULL ,
	MO_CO_NUM NUMBER(38,0) NOT NULL ,
	MOVIE_NUMBER NUMBER(38,0) NOT NULL 
)
DATA_RETENTION_TIME_IN_DAYS = 1;

CREATE TABLE MO_RENT_REC
(
	RENTAL_DATE DATE NULL ,
	DUE_DATE DATE NULL ,
	RENTAL_STATUS VARCHAR(20) NULL ,
	PAYMENT_TRANSACTION_NUMBER NUMBER(38,0) NULL ,
	OVERDUE_CHARGE NUMBER(38,0) NULL ,
	RENTAL_RATE NUMBER(38,0) NULL ,
	RENTAL_RECORD_DATE DATE NOT NULL ,
	MO_CO_NUM NUMBER(38,0) NOT NULL ,
	MOVIE_NUMBER NUMBER(38,0) NOT NULL ,
	CUST_NUMBER NUMBER(38,0) NOT NULL 
)
DATA_RETENTION_TIME_IN_DAYS = 1;

CREATE TABLE MOVIE
(
	MOVIE_TITLE VARCHAR(20) NULL ,
	MOVIE_DIRECTOR VARCHAR(20) NULL ,
	DESCRIPTION VARCHAR(20) NULL ,
	STAR_1_NAME VARCHAR(20) NULL ,
	RATING VARCHAR(16777216) NULL ,
	STAR_2_NAME VARCHAR(20) NULL ,
	MOVIE_NUMBER NUMBER(38,0) NOT NULL ,
	GENRE VARCHAR(1) NULL ,
	RENTAL_RATE NUMBER(38,0) NULL ,
	MOVIE_URL VARCHAR(16777216) NULL ,
	MOVIE_CLIP BINARY(8388608) NULL 
)
DATA_RETENTION_TIME_IN_DAYS = 1;

CREATE TABLE PAYMENT
(
	PAYMENT_TRANSACTION_NUMBER NUMBER(38,0) NOT NULL ,
	PAYMENT_TYPE VARCHAR(18) NULL ,
	PAYMENT_STATUS VARCHAR(1) NULL ,
	EMP_NUMBER VARCHAR(20) NOT NULL ,
	CUST_NUMBER NUMBER(38,0) NULL ,
	CUSTOMER_NO NUMBER(38,0) NULL ,
	CHECK_BANK_NUMBER NUMBER(38,0) NULL ,
	CHECK_NUMBER NUMBER(38,0) NULL ,
	EPAY_VENDOR_NUMBER NUMBER(38,0) NULL ,
	EPAY_ACCOUNT_NUMBER NUMBER(38,0) NULL ,
	CREDIT_CARD_NUMBER VARCHAR(18) NULL ,
	CREDIT_CARD_EXP TIMESTAMP_NTZ(9) NULL ,
	CREDIT_CARD_TYPE VARCHAR(18) NULL 
)
DATA_RETENTION_TIME_IN_DAYS = 1;

CREATE TABLE STORE
(
	STORE_MANAGER VARCHAR(20) NULL ,
	STORE_ADDRESS VARCHAR(20) NULL ,
	STORE_ADDRESS_2 VARCHAR(20) NULL ,
	STORE_PHONE NUMBER(38,0) NULL ,
	STORE_CITY VARCHAR(20) NULL ,
	STORE_STATE VARCHAR(20) NULL ,
	STORE_ZIP_CODE NUMBER(38,0) NULL ,
	STORE_NUMBER NUMBER(38,0) NOT NULL 
)
DATA_RETENTION_TIME_IN_DAYS = 1;

CREATE TABLE MOVIE_STORE
(
	MOVIE_NUMBER NUMBER(38,0) NOT NULL ,
	STORE_NUMBER NUMBER(38,0) NOT NULL 
)
DATA_RETENTION_TIME_IN_DAYS = 1;

ALTER TABLE CUST
	ADD CONSTRAINT XPKCUSTOMER PRIMARY KEY (CUST_NUMBER);

ALTER TABLE CUST
	ADD CONSTRAINT XAK1CUSTOMER UNIQUE (CUST_ADDRESS);

ALTER TABLE CUST_CREDIT
	ADD CONSTRAINT XPKCUSTOMER_CREDIT PRIMARY KEY (CUST_NUMBER);

ALTER TABLE EMP
	ADD CONSTRAINT XPKEMPLOYEE PRIMARY KEY (EMP_NUMBER);

ALTER TABLE EMP
	ADD CONSTRAINT XAK1EMPLOYEE UNIQUE (EMP_PHONE,SOC_SEC_NUMBER);

ALTER TABLE MOVIE_COPY
	ADD CONSTRAINT XPKMOVIE_COPY PRIMARY KEY (MOVIE_NUMBER, MO_CO_NUM);

ALTER TABLE MO_RENT_REC
	ADD CONSTRAINT XPKMOVIE_RENTAL_RECORD PRIMARY KEY (CUST_NUMBER, MOVIE_NUMBER, MO_CO_NUM, RENTAL_RECORD_DATE);

ALTER TABLE MOVIE
	ADD CONSTRAINT XPKMOVIE PRIMARY KEY (MOVIE_NUMBER);

ALTER TABLE MOVIE
	ADD CONSTRAINT XAK1MOVIE UNIQUE (MOVIE_TITLE);

ALTER TABLE PAYMENT
	ADD CONSTRAINT XPKPAYMENT PRIMARY KEY (PAYMENT_TRANSACTION_NUMBER);

ALTER TABLE STORE
	ADD CONSTRAINT XPKSTORE PRIMARY KEY (STORE_NUMBER);

ALTER TABLE MOVIE_STORE
	ADD CONSTRAINT XPKMOVIE_STORE PRIMARY KEY (MOVIE_NUMBER, STORE_NUMBER);

ALTER TABLE EMP
	ADD CONSTRAINT REPORTS_TO FOREIGN KEY (SUPERVISOR) REFERENCES EMP (EMP_NUMBER);

ALTER TABLE EMP
	ADD CONSTRAINT EMPLOYS_IS FOREIGN KEY (STORE_NUMBER) REFERENCES STORE (STORE_NUMBER);

ALTER TABLE MOVIE_COPY
	ADD CONSTRAINT IS_RENTED_AS FOREIGN KEY (MOVIE_NUMBER) REFERENCES MOVIE (MOVIE_NUMBER);

ALTER TABLE MO_RENT_REC
	ADD CONSTRAINT R_8_2 FOREIGN KEY (CUST_NUMBER) REFERENCES CUST_CREDIT (CUST_NUMBER);

ALTER TABLE MO_RENT_REC
	ADD CONSTRAINT IS_RENTED_UNDER FOREIGN KEY (MOVIE_NUMBER, MO_CO_NUM) REFERENCES MOVIE_COPY (MOVIE_NUMBER, MO_CO_NUM);

ALTER TABLE MO_RENT_REC
	ADD CONSTRAINT IS_MADE_ON FOREIGN KEY (PAYMENT_TRANSACTION_NUMBER) REFERENCES PAYMENT (PAYMENT_TRANSACTION_NUMBER);

ALTER TABLE PAYMENT
	ADD CONSTRAINT R_7_1 FOREIGN KEY (CUSTOMER_NO) REFERENCES CUST (CUST_NUMBER);

ALTER TABLE PAYMENT
	ADD CONSTRAINT R_7_2 FOREIGN KEY (CUST_NUMBER) REFERENCES CUST_CREDIT (CUST_NUMBER);

ALTER TABLE PAYMENT
	ADD CONSTRAINT RECEIVES FOREIGN KEY (EMP_NUMBER) REFERENCES EMP (EMP_NUMBER);

ALTER TABLE MOVIE_STORE
	ADD CONSTRAINT RENTS FOREIGN KEY (MOVIE_NUMBER) REFERENCES MOVIE (MOVIE_NUMBER);

ALTER TABLE MOVIE_STORE
	ADD CONSTRAINT IS_IN FOREIGN KEY (STORE_NUMBER) REFERENCES STORE (STORE_NUMBER);

CREATE VIEW CUSTOMER_INVOICE
(
	credit_card,
	credit_card_exp,
	status_code,
	CUST_number,
	CUST_address,
	email,
	CUST_city,
	CUST_first_name,
	CUST_last_name,
	CUST_state,
	CUST_zip_code,
	rental_record_date,
	mo_co_num,
	movie_number,
	rental_date,
	due_date,
	rental_status,
	overdue_charge,
	rental_rate,
	movie_title,
	Overdue_Charge_Rate
)
AS 
SELECT  ALL CUST_CREDIT.credit_card,CUST_CREDIT.credit_card_exp,CUST_CREDIT.status_code,CUST.CUST_number,CUST.CUST_address,CUST.email,CUST.CUST_city,CUST.CUST_first_name,CUST.CUST_last_name,CUST.CUST_state,CUST.CUST_zip_code,MO_RENT_REC.rental_record_date,MO_RENT_REC.mo_co_num,MO_RENT_REC.movie_number,MO_RENT_REC.rental_date,MO_RENT_REC.due_date,MO_RENT_REC.rental_status,MO_RENT_REC.overdue_charge,MO_RENT_REC.rental_rate,MOVIE.movie_title,MO_RENT_REC.rental_rate * 1.5
FROM CUST_CREDIT ,CUST ,MO_RENT_REC ,MOVIE ;

CREATE VIEW OVERDUE_NOTICE
(
	credit_card,
	credit_card_exp,
	status_code,
	Overdue_Charge_Rate,
	CUST_number,
	CUST_address,
	email,
	CUST_city,
	CUST_first_name,
	CUST_last_name,
	CUST_state,
	CUST_zip_code,
	rental_record_date,
	mo_co_num,
	movie_number,
	rental_date,
	due_date,
	rental_status,
	overdue_charge,
	rental_rate
)
AS 
SELECT  ALL CUST_CREDIT.credit_card,CUST_CREDIT.credit_card_exp,CUST_CREDIT.status_code,rental_rate * 1.5,CUST.CUST_number,CUST.CUST_address,CUST.email,CUST.CUST_city,CUST.CUST_first_name,CUST.CUST_last_name,CUST.CUST_state,CUST.CUST_zip_code,MO_RENT_REC.rental_record_date,MO_RENT_REC.mo_co_num,MO_RENT_REC.movie_number,MO_RENT_REC.rental_date,MO_RENT_REC.due_date,MO_RENT_REC.rental_status,MO_RENT_REC.overdue_charge,MO_RENT_REC.rental_rate
FROM CUST_CREDIT ,CUST ,MO_RENT_REC ;
